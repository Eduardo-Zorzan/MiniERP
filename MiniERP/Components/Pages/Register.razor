@page "/register"

@using MiniERP.BusinessRules.Files.Entities

<div class="container-main">
	<label class="return-btn">
		<a href="/" class="fa-solid fa-arrow-left"></a>
	</label>
	<content>
		<div class="title title-page">
			<h1>Register</h1>
		</div>
		<div class="p-0 flex-md-column align-items-center justify-content-center secondary-container">
			<div class="container-image mb-2">
				@if (_imageUrl == null)
				{
					<label class="custom-file-upload" for="file">
						<button id="file" @onclick="PickAndShow"></button>
						<div class="upload-icon">
							<i class="fa-solid fa-camera"></i>
						</div>
					</label>
				} 
				else
				{
					<p>sdfsdfsdfsdfsdf</p>
				}
			</div>
			<div id="inpEmail" class="mb-2 field">
				<label class="form-label">Email:</label>
				<div>
					<input class="form-control" />
				</div>
			</div>
			<div id="inpName" class="mb-2 field">
				<label class="form-label">Name:</label>
				<div>
					<input class="form-control" />
				</div>
			</div>
			<div id="inpPassword" class="mb-2 field">
				<label class="form-label">Password:</label>
				<div>
					<input class="form-control" />
				</div>
			</div>
			<div id="inpConfirmPassword" class="mb-2 field">
				<label class="form-label">Confirm Password:</label>
				<div>
					<input class="form-control" />
				</div>
			</div>
			<div class="mb-2">
				<button class="button" @onclick="UserRegister">Save</button>
			</div>
			<div>
				<button class="button">Delete</button>
			</div>
		</div>
	</content>
</div>

@code {
	private LazyBrowserFileStream _selectedFile;
	private string _imageUrl;

	public async Task PickAndShow()
	{
		try
		{
			var customFileType = new FilePickerFileType(
				new Dictionary<DevicePlatform, IEnumerable<string>>
				{
					{ DevicePlatform.iOS, new[] { "public.my.comic.extension" } }, // UTType values
                    { DevicePlatform.Android, new[] { "application/comics" } }, // MIME type
                    { DevicePlatform.WinUI, new[] { ".cbr", ".cbz" } }, // file extension
                    { DevicePlatform.Tizen, new[] { "*/*" } },
					{ DevicePlatform.macOS, new[] { "cbr", "cbz" } }, // UTType values
                });

			PickOptions options = new()
			{
				PickerTitle = "Please select a comic file",
				FileTypes = customFileType,
			};
			var result = await FilePicker.Default.PickAsync(options);
			if (result != null)
			{
				if (result.FileName.EndsWith("jpg", StringComparison.OrdinalIgnoreCase) ||
				  result.FileName.EndsWith("png", StringComparison.OrdinalIgnoreCase))
				{
					using var stream = await result.OpenReadAsync();
					var image = ImageSource.FromStream(() => stream);
				}
			}

			//return result;
		}
		catch (Exception ex)
		{
			// The user canceled or something went wrong
		}

	}

	private string PopulateImageFromStream(LazyBrowserFileStream stream)
    {
		MemoryStream ms = new MemoryStream();
		stream.CopyTo(ms);
		byte[] byteArray = ms.ToArray();
		var b64String = Convert.ToBase64String(byteArray);
		return "data:image/png;base64," + b64String;
    }

	private async Task UserRegister()
	{
        throw new Exception("Not implemented yet.");
    }
}
