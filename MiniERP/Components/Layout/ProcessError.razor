@using Microsoft.Extensions.Logging
@using System.Text
@using Microsoft.AspNetCore.Components

@inherits ErrorBoundary

@inject ErrorState ErrorState

@if (ErrorState.Running != null)
{
    @foreach (string msg in ErrorState.Running)
    {
        <div class="error-container">
            <div>
                <p>
                    <i class="fas fa-exclamation-triangle"></i>
                    @msg
                </p>
            </div>
        </div>
    }    
}

@ChildContent

@code {
    protected override Task OnErrorAsync(Exception ex)
    {
        if (ErrorState.Running?.Contains(ex.Message) ?? false)

            return Task.CompletedTask;

        AddErrorMessage(ex.Message);

        _ = ShowAndHideAsync(ex.Message);

        return Task.CompletedTask;
    }

    private async Task ShowAndHideAsync(string message)
    {

        await InvokeAsync(StateHasChanged);

        await Task.Delay(5000);

        ErrorState.Running.Remove(message);

        Recover();

        await InvokeAsync(StateHasChanged);
    }

    private void AddErrorMessage(string message)
    {
        if (ErrorState.Running == null)
            ErrorState.Running = new List<string>();

        ErrorState.Running.Add(message);
    }
}